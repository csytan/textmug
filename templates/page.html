{% extends "base.html" %}


{% block script %}
    <script>
        $(function(){
            initPage({% raw json_encode({
                'encrypted': page.encrypted,
                'public': page.public
            }) %});
        });
    </script>
{% end %}


{% block main %}
    <div class="user_header">
        {% if page.user %}
            <a href="/{{ page.user.id }}">
                {{ page.user.id }}
            </a>
            <span>/</span>
        {% elif current_user and not page.id %}
            <a href="/{{ current_user.id }}">
                {{ current_user.id }}
            </a>
            <span>/</span>
        {% end %}

        {% if current_user and page.editable(current_user) %}
            <input id="page_name" type="text" placeholder="new-page" 
                {% if not page.id %}class="active"{% end %}
                value="{{ page.page_name if page.page_name else '' }}">
        {% elif page.id %}
            {{ page.page_name or '# ' + str(page.id) }}
        {% else %}
            <span>new page - write something!</span>
        {% end %}
    </div>

    <div id="controls">
        {% if page.editable(current_user) %}
            <a class="menu_btn save icon-save"></a>
        {% end %}

        {% if current_user %}
            <a class="menu_btn locked icon-locked"></a>
            <a class="menu_btn unlocked icon-unlocked"></a>
            <a class="menu_btn settings icon-settings"></a>
        {% end %}
    </div>

    <div id="decrypt_dialog">
        <h2>This page is encrypted</h2>
        Enter a password to decrypt.
        <input id="password" class="text_input" type="password" placeholder="password">
        <a class="btn decrypt">decrypt</a>
    </div>

    <form id="settings_dialog" method="post">
        <h1>Settings</h1>

        <label>Sharing</label>
        <select name="public">
            <option value="0">Display publically</option>
            <option value="1">Keep this page private</option>
        </select>
        <br>

        <label>Encryption</label>
        <select name="encrypt">
            <option value="0">Don't encrypt this page</option>
            <option value="1">Enable client side encryption</option>
        </select>

        <div class="encrypt_password">
            <label>Password</label>
            <input type="password" placeholder="password">
        </div>

        <input class="btn" type="submit" value="Save">
    </form>

    <div id="editor" contenteditable="true">{{ page.text }}</div>
{% end %}

