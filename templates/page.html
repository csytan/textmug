{% extends "base.html" %}


{% block script %}
    <script>
        Editor.init(document.getElementById('editor'), {
            public: {% raw json_encode(page.public) %},
            encrypted: {% raw json_encode(page.encrypted) %},
            cipherJSON: {% raw json_encode(page.text if page.encrypted else None) %}
        });
    </script>
{% end %}


{% block main %}
    <div class="user_header">
        {% if page.id == 1 %}
        {% elif page.id %}
            {% if page.user %}
                <a href="/{{ page.user.id }}">
                    {{ page.user.id }}
                </a>
                <span>/</span>
            {% end %}

            {% if current_user and page.user == current_user %}
                <input id="page_name" class="input" type="text" placeholder="new-page" 
                    value="{{ page.page_name }}" maxlength="40">
            {% else %}
                <span>{{ page.page_name }}</span>
            {% end %}
        {% else %}
            {# new page #}
            {% if current_user %}
                <a href="/{{ current_user.id }}">
                    {{ current_user.id }}
                </a>
                <span>/</span>
                <input id="page_name" class="input" type="text" placeholder="new-page" maxlength="40" class="active">
            {% else %}
                <span>new page - write something!</span>
            {% end %}
        {% end %}
    </div>

    <div id="controls">
        {% if page.id == 1 %}
            <a class="control icon-plus" href="/new"></a>
        {% end %}
                
        {% if page.editable(current_user) %}
            <a class="control settings icon-cog"></a>
            <a class="control save icon-floppy"></a>
            <a class="control locked icon-locked"></a>
            <a class="control unlocked icon-unlocked"></a>
        {% end %}
    </div>

    <div id="decrypt_dialog" class="dialog">
        <h1>Page locked</h1>
        <p class="help">Please enter a password</p>
        <input name="page_password" class="input" type="password" placeholder="password">
        <input class="btn unlock" type="submit" value="Unlock">
    </div>

    <form id="settings_dialog" class="dialog" method="post">
        <div class="close icon-close"></div>
        {% raw xsrf_form_html() %}
        <h1>Settings</h1>

        <label>Sharing</label>
        <select name="public">
            <option value="true">Display publically</option>
            <option value="false">Keep this page private</option>
        </select>
        
        <div class="encryption">
            <label>Encryption</label>
            <select name="encrypted">
                <option value="false">Don't encrypt this page</option>
                <option value="true">Enable client side encryption</option>
            </select>
            
            <div class="encrypt_password">
                <label>Password</label>
                <input name="password" class="input" type="password" placeholder="password">
            </div>
        </div>

        <label>Deletion</label>
        <a class="btn delete">Delete page</a> 
        <div></div>

        <input class="btn" type="submit" value="Save settings">
    </form>

    <div id="editor" contenteditable="true">{% if not page.encrypted %}{{ page.text }}{% end %}</div>
{% end %}

