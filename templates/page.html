{% extends "base.html" %}


{% block script %}
    <script>
        $(function(){
            initPage({% raw json_encode({
                'encrypted': page.encrypted,
                'public': page.public
            }) %});
        });
    </script>
{% end %}


{% block main %}
    <div class="user_header">
        {% if page.id %}
            {% if page.user %}
                <a href="/{{ page.user.id }}">
                    {{ page.user.id }}
                </a>
                <span>/</span>
            {% end %}

            {% if current_user and page.user == current_user %}
                <input id="page_name" type="text" placeholder="new-page" 
                    value="{{ page.page_name }}" maxlength="40">
            {% else %}
                <span>{{ page.page_name }}</span>
            {% end %}
        {% else %}
            {# new page #}
            {% if current_user %}
                <a href="/{{ current_user.id }}">
                    {{ current_user.id }}
                </a>
                <span>/</span>
                <input id="page_name" type="text" placeholder="new-page" maxlength="40" class="active">
            {% else %}
                <span>new page - write something!</span>
            {% end %}
        {% end %}
    </div>

    <div id="controls">
        {% if page.editable(current_user) %}
            <a class="menu_btn save icon-save"></a>
        {% end %}
        
        {% if page.id == 1 %}
            <a class="menu_btn icon-file-add" href="/new"></a>
        {% end %}
        
        {% if current_user %}
            <a class="menu_btn locked icon-locked"></a>
            <a class="menu_btn unlocked icon-unlocked"></a>
            <a class="menu_btn settings icon-settings"></a>
        {% end %}
    </div>

    <div id="decrypt_dialog">
        <h2>This page is encrypted</h2>
        Enter a password to decrypt.
        <input id="password" class="text_input" type="password" placeholder="password">
        <a class="btn decrypt">decrypt</a>
    </div>

    <form id="settings_dialog" method="post">
        <h1>Settings</h1>

        <label>Sharing</label>
        <select name="public">
            <option value="0">Display publically</option>
            <option value="1">Keep this page private</option>
        </select>
        <br>

        <label>Encryption</label>
        <select name="encrypt">
            <option value="0">Don't encrypt this page</option>
            <option value="1">Enable client side encryption</option>
        </select>

        <div class="encrypt_password">
            <label>Password</label>
            <input type="password" placeholder="password">
        </div>

        <input class="btn" type="submit" value="Save">
    </form>

    <div id="editor" contenteditable="true">{{ page.text }}</div>
{% end %}

